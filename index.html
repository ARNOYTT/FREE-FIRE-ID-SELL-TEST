<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FF ID Store â€” Liquid Glass</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* ------- LIQUID GLASS THEME ------- */
        body {
            background: linear-gradient(135deg, #09101c, #0b1628, #09101c);
            background-size: 300% 300%;
            animation: bgMove 12s infinite alternate;
            color: white;
            font-family: "Poppins", sans-serif;
        }

        @keyframes bgMove {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .glass {
            background: rgba(255, 255, 255, 0.07);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.4);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.10);
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
        }

        .account-card {
            transition: 0.3s ease;
        }
        .account-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.35);
        }

        /* MODALS */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            top: 0; left: 0;
            width: 100%; height: 100%;
            backdrop-filter: blur(6px);
            background: rgba(0, 0, 0, 0.55);
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255,255,255,0.15);
            backdrop-filter: blur(18px);
            border-radius: 20px;
            padding: 25px;
            margin: 5% auto;
            max-width: 600px;
            width: 92%;
        }
    </style>
</head>
<body>

    <!-- LOGIN / REGISTER -->
    <div id="auth-section" class="max-w-md mx-auto mt-16 p-6 glass">
        <h2 class="text-3xl font-bold text-center mb-6">Login or Register</h2>

        <div class="mb-4">
            <label class="block mb-1">Email:</label>
            <input type="email" id="email" class="w-full p-3 rounded glass-input">
        </div>

        <div class="mb-6">
            <label class="block mb-1">Password:</label>
            <input type="password" id="password" class="w-full p-3 rounded glass-input">
        </div>

        <div class="flex gap-4">
            <button id="login-btn" class="flex-1 bg-blue-500 hover:bg-blue-600 py-2 rounded font-bold">Login</button>
            <button id="register-btn" class="flex-1 bg-green-500 hover:bg-green-600 py-2 rounded font-bold">Register</button>
        </div>
    </div>

    <!-- APP SECTION -->
    <div id="app-section" class="hidden">

        <header class="glass p-4 flex justify-between items-center sticky top-0 z-50 mx-2 mt-2">
            <div>
                <h1 class="text-xl font-bold">FF ID Store</h1>
                <p id="user-email" class="text-gray-300 text-sm"></p>
            </div>

            <div class="flex items-center gap-3">
                <span class="font-bold text-cyan-300">Wallet: â‚¹<span id="wallet-balance">0</span></span>
                <button id="deposit-btn" class="bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-1 px-3 rounded">Deposit</button>
                <button id="logout-btn" class="bg-red-600 hover:bg-red-700 py-1 px-3 rounded">Logout</button>
            </div>
        </header>

        <main id="accounts-container"
            class="p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        </main>
    </div>

    <!-- DEPOSIT MODAL -->
    <div id="deposit-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-2xl font-bold mb-3">Deposit Money</h3>
            <p class="text-gray-300 mb-3">Scan the QR & fill the details.</p>

            <img src="https://uploads.onecompiler.io/445apq2ce/445apnb6g/IMG-20251101-WA0001%5B1%5D.jpg"
                 class="mx-auto mb-3 rounded-lg border">

            <input id="payer-name" placeholder="Name" class="w-full p-3 mb-2 rounded glass-input">
            <input id="utr-id" placeholder="UTR ID" class="w-full p-3 mb-2 rounded glass-input">
            <input id="deposit-amount" placeholder="Amount" class="w-full p-3 mb-3 rounded glass-input">

            <button id="submit-deposit-btn" class="w-full bg-blue-600 hover:bg-blue-700 py-2 rounded font-bold">Submit</button>
            <button onclick="closeModal('deposit-modal')" class="w-full bg-gray-600 hover:bg-gray-700 py-2 rounded mt-2">Close</button>
        </div>
    </div>

    <!-- DETAILS MODAL -->
    <div id="details-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title" class="text-3xl font-bold mb-3"></h3>

            <img id="modal-main-image" class="w-full h-64 object-cover rounded mb-3">

            <h4 class="text-xl font-semibold mb-1">Description</h4>
            <p id="modal-description" class="text-gray-300 mb-3 whitespace-pre-wrap"></p>

            <h4 class="text-xl font-semibold mb-1">More Images</h4>
            <div id="modal-other-images" class="grid grid-cols-2 sm:grid-cols-3 gap-2 mb-4"></div>

            <div id="modal-buttons"></div>

            <button onclick="closeModal('details-modal')" class="w-full mt-4 bg-gray-600 hover:bg-gray-700 py-2 rounded">Close</button>
        </div>
    </div>

    <!-- PURCHASE CREDENTIALS -->
    <div id="credentials-modal" class="modal">
        <div class="modal-content text-center">
            <h3 class="text-3xl font-bold mb-3 text-green-400">ðŸŽ‰ Purchase Successful!</h3>

            <div class="glass p-4 text-left mb-3">
                <p><strong>ID/Email:</strong> <span id="purchased-id"></span></p>
                <p><strong>Password:</strong> <span id="purchased-pass"></span></p>
            </div>

            <button onclick="closeModal('credentials-modal')" class="w-full bg-gray-600 hover:bg-gray-700 py-2 rounded">Close</button>
        </div>
    </div>

    <!-- FIREBASE (UNTOUCHED) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getDatabase, ref, set, get, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCmeoKy9MKYkOjifIxmu4I-wtog8SkC7ps",
            authDomain: "free-fire-id-store-app-test.firebaseapp.com",
            databaseURL: "https://free-fire-id-store-app-test-default-rtdb.firebaseio.com",
            projectId: "free-fire-id-store-app-test",
            storageBucket: "free-fire-id-store-app-test.firebasestorage.app",
            messagingSenderId: "945441219174",
            appId: "1:945441219174:web:690a858cad1c5fd9cf83a7",
            measurementId: "G-3HRF5G0PN8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        const authSection = document.getElementById("auth-section");
        const appSection = document.getElementById("app-section");
        const userEmailEl = document.getElementById("user-email");
        const walletBalanceEl = document.getElementById("wallet-balance");
        const accountsContainer = document.getElementById("accounts-container");
        const detailsModal = document.getElementById("details-modal");

        let currentUser = null;
        let userWallet = 0;
        let isWalletSystemDisabled = false;

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                authSection.classList.add("hidden");
                appSection.classList.remove("hidden");
                userEmailEl.textContent = user.email;
                listenToWallet();
                listenToSettings();
                loadAccounts();
            } else {
                currentUser = null;
                authSection.classList.remove("hidden");
                appSection.classList.add("hidden");
            }
        });

        document.getElementById("login-btn").addEventListener("click", async () => {
            const email = email.value.trim();
            const password = document.getElementById("password").value;

            if (!email || !password) return alert("Fill all fields");

            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (err) { alert(err.message); }
        });

        document.getElementById("register-btn").addEventListener("click", async () => {
            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value;

            if (!email || !password) return alert("Fill all fields");
            if (password.length < 6) return alert("Password too short");

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await set(ref(db, `users/${userCredential.user.uid}/wallet`), 0);
            } catch (err) { alert(err.message); }
        });

        document.getElementById("logout-btn").addEventListener("click", () => signOut(auth));

        function closeModal(id) { document.getElementById(id).style.display = "none"; }

        function listenToWallet() {
            onValue(ref(db, `users/${currentUser.uid}/wallet`), (snap) => {
                userWallet = snap.val() || 0;
                walletBalanceEl.textContent = userWallet;
            });
        }

        function listenToSettings() {
            onValue(ref(db, "settings/isWalletDisabled"), (s) => {
                isWalletSystemDisabled = s.val() === true;
            });
        }

        function loadAccounts() {
            onValue(ref(db, "accounts"), (snap) => {
                accountsContainer.innerHTML = "";
                const data = snap.val();
                if (!data) {
                    accountsContainer.innerHTML = "<p>No accounts available</p>";
                    return;
                }
                Object.entries(data).forEach(([id, acc]) => {
                    const card = document.createElement("div");
                    card.className = "glass overflow-hidden account-card";
                    card.dataset.id = id;
                    card.innerHTML = `
                        <img src="${acc.mainImage}" class="w-full h-48 object-cover">
                        <div class="p-3">
                            <h3 class="font-bold text-xl">${acc.name}</h3>
                            <p class="text-gray-300">${acc.description.split("\n")[0]}</p>
                            <p class="text-cyan-300 font-bold mt-1">â‚¹${acc.price}</p>
                        </div>
                    `;
                    accountsContainer.appendChild(card);
                });
            });
        }

        accountsContainer.addEventListener("click", async (e) => {
            const card = e.target.closest(".account-card");
            if (!card) return;

            const id = card.dataset.id;
            const snap = await get(ref(db, `accounts/${id}`));
            if (!snap.exists()) return alert("Unavailable");

            const acc = snap.val();
            document.getElementById("modal-title").textContent = acc.name;
            document.getElementById("modal-main-image").src = acc.mainImage;
            document.getElementById("modal-description").textContent = acc.description;

            const imgBox = document.getElementById("modal-other-images");
            imgBox.innerHTML = "";
            if (acc.otherImages) {
                acc.otherImages.forEach((img) => {
                    imgBox.innerHTML += `<img src="${img}" class="rounded h-32 w-full object-cover">`;
                });
            }

            const btns = document.getElementById("modal-buttons");
            btns.innerHTML = `<a href="${acc.contactLink}" target="_blank"
            class="block w-full text-center bg-purple-600 py-2 rounded mt-2">Contact Owner</a>`;

            if (!isWalletSystemDisabled || userWallet >= acc.price) {
                btns.innerHTML += `
                    <button class="buy-btn w-full bg-green-600 py-2 rounded mt-2"
                        data-id="${id}">Buy (â‚¹${acc.price})</button>
                `;
            }

            detailsModal.style.display = "block";
        });

        document.addEventListener("click", async (e) => {
            if (!e.target.classList.contains("buy-btn")) return;

            const id = e.target.dataset.id;
            const snap = await get(ref(db, `accounts/${id}`));
            if (!snap.exists()) return alert("Unavailable");

            const acc = snap.val();
            if (userWallet < acc.price) return alert("Not enough balance");

            await set(ref(db, `users/${currentUser.uid}/wallet`), userWallet - acc.price);
            await remove(ref(db, `accounts/${id}`));

            closeModal("details-modal");

            document.getElementById("purchased-id").textContent = acc.ffId;
            document.getElementById("purchased-pass").textContent = acc.ffPassword;
            document.getElementById("credentials-modal").style.display = "block";
        });

        document.getElementById("deposit-btn").addEventListener("click", () => {
            document.getElementById("deposit-modal").style.display = "block";
        });

        document.getElementById("submit-deposit-btn").addEventListener("click", () => {
            const name = payer-name.value.trim();
            const utr = utr-id.value.trim();
            const amount = parseFloat(deposit-amount.value);

            if (!name || !utr || !amount) return alert("Fill all fields");

            const requestId = "req_" + Date.now();
            set(ref(db, `depositRequests/${requestId}`), {
                userId: currentUser.uid,
                userEmail: currentUser.email,
                payerName: name,
                utr: utr,
                amount: amount,
                timestamp: new Date().toISOString()
            });

            closeModal("deposit-modal");
        });
    </script>

</body>
</html>
